
import { useState } from "react";
import { Link, useLocation } from "react-router-dom";
import { createPageUrl } from "@/utils";
import { 
  Search, 
  MapPin, 
  User, 
  Menu, 
  X,
  Building,
  Phone,
  Mail,
  PlusCircle
} from "lucide-react";
import {
  Sidebar,
  SidebarContent,
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarHeader,
  SidebarFooter,
  SidebarProvider,
} from "@/components/ui/sidebar";
import { Button } from "@/components/ui/button";
import Navbar from "./components/navigation/Navbar";
import AIChatbot from "./components/chatbot/AIChatbot";

const navigationItems = [
  {
    title: "Find Properties",
    url: createPageUrl("Search"),
    icon: Search,
    description: "Browse accommodations"
  },
  {
    title: "Map View",
    url: createPageUrl("MapView"),
    icon: MapPin,
    description: "Locate on map"
  },
  {
    title: "List Your Property",
    url: createPageUrl("AdminDashboard"),
    icon: PlusCircle,
    description: "Manage & add listings"
  },
];

export default function Layout({ children, currentPageName }) {
  const location = useLocation();
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  return (
    <div className="min-h-screen bg-white">
      {/* Navbar */}
      <Navbar />
      
      <SidebarProvider>
        <div className="flex w-full pt-16">
          {/* Desktop Sidebar */}
          <Sidebar className="hidden lg:flex border-r border-gray-100 bg-white">
            <SidebarHeader className="border-b border-gray-100 p-6">
              <Link to={createPageUrl("Search")} className="flex items-center gap-3 group">
                <div className="w-12 h-12 bg-gradient-to-r from-sky-500 to-sky-600 rounded-2xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all duration-300">
                  <Building className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h2 className="text-2xl font-bold bg-gradient-to-r from-sky-500 to-sky-600 bg-clip-text text-transparent">
                    StayNearU
                  </h2>
                  <p className="text-sm text-gray-500">Find Your Perfect Stay</p>
                </div>
              </Link>
            </SidebarHeader>
            
            <SidebarContent className="p-4">
              <SidebarGroup>
                <SidebarGroupLabel className="text-xs font-semibold text-gray-500 uppercase tracking-wider px-2 py-2">
                  Navigation
                </SidebarGroupLabel>
                <SidebarGroupContent>
                  <SidebarMenu className="space-y-2">
                    {navigationItems.map((item) => (
                      <SidebarMenuItem key={item.title}>
                        <SidebarMenuButton 
                          asChild 
                          className={`hover:bg-sky-50 hover:text-sky-700 transition-all duration-300 rounded-xl p-3 ${
                            location.pathname === item.url 
                              ? 'bg-sky-100 text-sky-700 shadow-sm' 
                              : ''
                          }`}
                        >
                          <Link to={item.url} className="flex items-center gap-3">
                            <item.icon className="w-5 h-5" />
                            <div>
                              <span className="font-semibold text-gray-900">{item.title}</span>
                              <p className="text-xs text-gray-500">{item.description}</p>
                            </div>
                          </Link>
                        </SidebarMenuButton>
                      </SidebarMenuItem>
                    ))}
                  </SidebarMenu>
                </SidebarGroupContent>
              </SidebarGroup>

              <SidebarGroup className="mt-8">
                <SidebarGroupLabel className="text-xs font-semibold text-gray-500 uppercase tracking-wider px-2 py-2">
                  Quick Contact
                </SidebarGroupLabel>
                <SidebarGroupContent>
                  <div className="px-3 py-2 space-y-3">
                    <div className="flex items-center gap-2 text-sm text-gray-600">
                      <Phone className="w-4 h-4 text-sky-500" />
                      <span>+91 98765 43210</span>
                    </div>
                    <div className="flex items-center gap-2 text-sm text-gray-600">
                      <Mail className="w-4 h-4 text-sky-500" />
                      <span>support@staynearu.com</span>
                    </div>
                  </div>
                </SidebarGroupContent>
              </SidebarGroup>
            </SidebarContent>

            <SidebarFooter className="border-t border-gray-100 p-4">
              <div className="bg-sky-50 rounded-xl p-4">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-gradient-to-r from-sky-500 to-sky-600 rounded-full flex items-center justify-center">
                    <User className="w-5 h-5 text-white" />
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="font-semibold text-gray-900 text-sm">Welcome!</p>
                    <p className="text-xs text-gray-600">Find your perfect accommodation</p>
                  </div>
                </div>
              </div>
            </SidebarFooter>
          </Sidebar>

          <main className="flex-1 flex flex-col min-h-screen bg-gray-50">
            {/* Mobile Header */}
            <header className="lg:hidden bg-white backdrop-blur-xl border-b border-gray-100 px-4 py-3 sticky top-16 z-40">
              <div className="flex items-center justify-between">
                <Link to={createPageUrl("Search")} className="flex items-center gap-2">
                  <div className="w-8 h-8 bg-gradient-to-r from-sky-500 to-sky-600 rounded-lg flex items-center justify-center">
                    <Building className="w-4 h-4 text-white" />
                  </div>
                  <span className="text-lg font-bold bg-gradient-to-r from-sky-500 to-sky-600 bg-clip-text text-transparent">
                    StayNearU
                  </span>
                </Link>
                <Button
                  variant="ghost"
                  size="icon"
                  onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                  className="lg:hidden"
                >
                  {mobileMenuOpen ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
                </Button>
              </div>
            </header>

            {/* Mobile Menu */}
            {mobileMenuOpen && (
              <div className="lg:hidden bg-white border-b border-gray-100 px-4 py-4">
                <nav className="space-y-2">
                  {navigationItems.map((item) => (
                    <Link
                      key={item.title}
                      to={item.url}
                      onClick={() => setMobileMenuOpen(false)}
                      className={`flex items-center gap-3 p-3 rounded-xl transition-all duration-300 ${
                        location.pathname === item.url 
                          ? 'bg-sky-100 text-sky-700' 
                          : 'hover:bg-gray-100'
                      }`}
                    >
                      <item.icon className="w-5 h-5" />
                      <div>
                        <span className="font-semibold text-gray-900">{item.title}</span>
                        <p className="text-xs text-gray-500">{item.description}</p>
                      </div>
                    </Link>
                  ))}
                </nav>
              </div>
            )}

            {/* Main Content */}
            <div className="flex-1">
              {children}
            </div>
          </main>
        </div>
      </SidebarProvider>

      {/* AI Chatbot */}
      <AIChatbot />
    </div>
  );
}
